# Сценарии демонстрации проекта "Поликлиника"

## Подготовка к демонстрации

1. Запустить Docker Desktop
2. Запустить базу данных: `docker compose up -d`
3. Запустить сервер: `cd app/server && npm start`
4. Запустить клиент: `cd app/client && npm run dev`
5. Открыть браузер: `http://localhost:5173`

---

## Сценарий 1: Работа с пациентами (CRUD)

**Цель:** Показать полный цикл работы с основной сущностью системы.

### 1.1. Успешная регистрация пациента (позитивный)

**Шаги:**
1. Перейти в раздел **"Пациенты"**
2. Нажать кнопку **"+ Добавить пациента"**
3. Заполнить форму:
   - Фамилия: `Тестов`
   - Имя: `Тест`
   - Отчество: `Тестович`
   - Дата рождения: `01.01.1990`
   - Пол: `Мужской`
   - Телефон: `+7-900-111-22-33`
   - Email: `testov@test.ru`
   - СНИЛС: `111-222-333 44`
   - Полис ОМС: `9999888877776666`
   - Страна: `Россия`, Город: `Томск`, Улица: `ул. Ленина`
   - Дом: `1`, Квартира: `1`
4. Нажать "Сохранить"

**Ожидаемый результат:**
- Модальное окно закрылось
- Пациент появился в таблице

### 1.2. Проверка обязательных полей (негативный)

**Шаги:**
1. Нажать "+" Добавить пациента"
2. Оставить все поля пустыми
3. Нажать "Сохранить"

**Ожидаемый результат:**
- Форма НЕ отправляется
- Поля с `required` подсвечиваются как невалидные

### 1.3. Дубликат полиса ОМС (негативный)

**Шаги:**
1. Нажать "+ Добавить пациента"
2. Заполнить обязательные поля
3. В поле "Полис ОМС" ввести `1234567890123456` (уже существует у Иванова)
4. Нажать "Сохранить"

**Ожидаемый результат:**
- Сообщение: **"Пациент с таким полисом ОМС уже существует"**
- Пациент НЕ создаётся

### 1.4. Дубликат СНИЛС (негативный)

**Шаги:**
1. Создать пациента со СНИЛС `123-456-789 01` (уже существует)

**Ожидаемый результат:**
- Сообщение: **"Пациент с таким СНИЛС уже существует"**

### 1.5. Редактирование пациента (позитивный)

**Шаги:**
1. Найти пациента "Смирнова Екатерина"
2. Нажать "Изм."
3. Проверить, что форма открылась с текущими данными
4. Изменить телефон на `+7-999-000-00-00`
5. Нажать "Сохранить"

**Ожидаемый результат:**
- Телефон обновился в таблице

### 1.6. Удаление пациента со связями (негативный)

**Шаги:**
1. Найти пациента "Иванов Александр" (у него есть приёмы)
2. Нажать "Уд." → Подтвердить

**Ожидаемый результат:**
- Сообщение: **"Невозможно удалить пациента: есть связанные приёмы"**
- Пациент НЕ удаляется

### 1.7. Успешное удаление (позитивный)

**Шаги:**
1. Создать тестового пациента без приёмов
2. Нажать "Уд." → Подтвердить

**Ожидаемый результат:**
- Пациент удалён из таблицы

**Что демонстрируется:**
- Валидация обязательных полей
- Уникальность ключевых полей (полис, СНИЛС, email)
- Защита целостности данных (внешние ключи)
- Защита от случайного удаления

---

## Сценарий 2: Запись на приём

**Цель:** Показать связь между сущностями (пациент → врач → приём).

### 2.1. Успешная запись (позитивный)

**Шаги:**
1. Перейти в раздел **"Приёмы"**
2. Нажать **"+ Записать на приём"**
3. Заполнить:
   - Пациент: `Иванов Александр`
   - Врач: `Петров Иван`
   - Дата и время: завтра, `10:00`
   - Статус: `Запланирован`
   - Цель визита: `Плановый осмотр`
4. Сохранить

**Ожидаемый результат:**
- Приём создан со статусом "Запланирован"
- В таблице отображается пациент, врач, дата

### 2.2. Изменение статуса приёма (позитивный)

**Шаги:**
1. Найти созданный приём
2. Нажать "Изм."
3. Изменить статус на `Завершён`
4. Сохранить

**Ожидаемый результат:**
- Статус обновился в таблице

### 2.3. Удаление врача с приёмами (негативный)

**Шаги:**
1. Перейти в "Врачи"
2. Найти "Петров Иван" (у него есть приёмы)
3. Нажать "Уд." → Подтвердить

**Ожидаемый результат:**
- Сообщение: **"Невозможно удалить врача: есть связанные приёмы"**

**Что демонстрируется:**
- Выпадающие списки с данными из связанных таблиц
- Статусная модель приёмов
- Защита связанных данных

---

## Сценарий 3: Фильтрация данных

**Цель:** Показать возможности поиска и фильтрации.

### 3.1. Фильтрация пациентов (позитивный)

**Шаги:**
1. Перейти в **"Пациенты"**
2. Нажать **"Фильтры"**
3. Установить: Пол = `Мужской`
4. Нажать "Применить"
5. Добавить: Возраст от `30` до `50`
6. Применить — показать сужение выборки

**Ожидаемый результат:**
- В таблице только мужчины 30-50 лет
- На кнопке счётчик `(2)`

### 3.2. Пустой результат фильтрации (граничный)

**Шаги:**
1. Установить: Возраст от `100` до `150`
2. Применить

**Ожидаемый результат:**
- Таблица пустая (нет ошибок)

### 3.3. Сброс фильтров (позитивный)

**Шаги:**
1. При активных фильтрах нажать "Сбросить"

**Ожидаемый результат:**
- Все фильтры сброшены
- Таблица показывает всех пациентов
- Счётчик на кнопке исчез

### 3.4. Фильтрация приёмов по статусу и дате

**Шаги:**
1. Перейти в **"Приёмы"**
2. Фильтр: Статус = `Завершён`, Дата с = `01.01.2024`
3. Применить

**Ожидаемый результат:**
- Только завершённые приёмы за указанный период

### 3.5. Фильтрация врачей по специальности

**Шаги:**
1. Перейти в **"Врачи"**
2. Фильтр: Специальность = `Терапевт`
3. Применить

**Ожидаемый результат:**
- Только врачи со специальностью "Терапевт"

**Что демонстрируется:**
- Комбинирование нескольких фильтров
- Корректная работа при отсутствии результатов
- Фильтрация по связанным сущностям

---

## Сценарий 4: Выборки (готовые отчёты)

**Цель:** Показать предустановленные фильтры для типовых задач.

### 4.1. Пациенты без полиса ОМС (позитивный)

**Шаги:**
1. Перейти в **"Выборки"**
2. Нажать "Показать" на карточке "Пациенты без полиса ОМС"

**Ожидаемый результат:**
- Таблица с пациентами, у которых нет полиса
- Применение: администратор напоминает оформить полис

### 4.2. Приёмы на сегодня (позитивный)

**Шаги:**
1. Выбрать "Приёмы на сегодня"

**Ожидаемый результат:**
- Расписание на текущий день
- Применение: врач видит свой график

### 4.3. Неявки за месяц (позитивный)

**Шаги:**
1. Выбрать "Неявки за месяц"

**Ожидаемый результат:**
- Список неявок за 30 дней
- Применение: администратор связывается с пациентами

**Что демонстрируется:**
- Бизнес-логика в готовых выборках
- Удобство для конечного пользователя

---

## Сценарий 5: Экспорт данных в CSV

**Цель:** Показать формирование отчётов для внешнего использования.

### 5.1. Экспорт пациентов (позитивный)

**Шаги:**
1. Перейти в **"Пациенты"**
2. Нажать **"Скачать CSV"**
3. Открыть файл в Excel

**Ожидаемый результат:**
- Файл `patients_report.csv` скачан
- Данные разбиты по колонкам
- Кириллица отображается корректно
- Телефоны сохранены как текст

### 5.2. Отчёт по посещениям пациента (позитивный)

**Шаги:**
1. Нажать **"Отчёт по посещениям"**
2. Выбрать пациента: `Иванов Александр`
3. Нажать "Скачать отчёт"

**Ожидаемый результат:**
- Файл с заголовком (ФИО, дата формирования)
- История всех посещений с диагнозами

**Что демонстрируется:**
- Интеграция с Excel
- Формирование персональных отчётов
- Решение проблем с кодировкой

---

## Сценарий 6: Медицинские записи и анализы

**Цель:** Показать ведение истории болезни.

### 6.1. Создание медицинской записи (позитивный)

**Шаги:**
1. Перейти в **"Мед. записи"**
2. Нажать "+ Добавить запись"
3. Заполнить:
   - Приём: выбрать завершённый приём
   - Пациент: `Иванов Александр`
   - Диагноз: `J06.9 - ОРВИ`
   - Описание: `Жалобы на насморк и кашель. Назначено лечение.`
4. Сохранить

**Ожидаемый результат:**
- Запись создана с кодом МКБ-10

### 6.2. Фильтрация по диагнозу (позитивный)

**Шаги:**
1. Открыть фильтры
2. Выбрать диагноз: `J06.9`
3. Применить

**Ожидаемый результат:**
- Все записи с диагнозом ОРВИ

### 6.3. Назначение анализа (позитивный)

**Шаги:**
1. Перейти в **"Анализы"**
2. Нажать "+ Назначить анализ"
3. Заполнить:
   - Тип: `Общий анализ крови`
   - Приём: выбрать
   - Дата назначения: сегодня
4. Сохранить — статус "Ожидает"

**Ожидаемый результат:**
- Анализ создан со статусом "Ожидает"

### 6.4. Выполнение анализа (позитивный)

**Шаги:**
1. Найти созданный анализ
2. Нажать "Изм."
3. Заполнить дату выполнения и результат
4. Сохранить

**Ожидаемый результат:**
- Статус изменился на "Выполнен"

### 6.5. Дата выполнения раньше назначения (негативный)

**Шаги:**
1. При редактировании анализа установить дату выполнения раньше даты назначения

**Ожидаемый результат:**
- Сообщение: **"Дата выполнения не может быть раньше даты назначения"**

**Что демонстрируется:**
- Связь приём → мед. запись → диагноз
- Справочник МКБ-10
- Статусная модель анализов
- Валидация бизнес-правил

---

## Сценарий 7: Справочники системы

**Цель:** Показать настраиваемость системы.

### 7.1. Просмотр справочника диагнозов (позитивный)

**Шаги:**
1. Перейти в **"Справочники" → "Диагнозы"**
2. Показать справочник МКБ-10

### 7.2. Дубликат кода диагноза (негативный)

**Шаги:**
1. Нажать "+ Добавить"
2. Ввести код: `J00` (уже существует)
3. Сохранить

**Ожидаемый результат:**
- Сообщение: **"Диагноз с таким кодом уже существует"**

### 7.3. Удаление специальности (негативный)

**Шаги:**
1. Перейти в "Специальности"
2. Найти "Терапевт" (назначена врачам)
3. Нажать "Уд."

**Ожидаемый результат:**
- Сообщение: **"Невозможно удалить специальность: она назначена врачам"**

**Что демонстрируется:**
- Расширяемость через справочники
- Защита целостности справочных данных

---

## Сценарий 8: Демонстрация архитектуры

**Цель:** Ответить на технические вопросы.

### 8.1. База данных

1. Показать Docker Desktop — контейнер PostgreSQL работает
2. Подключиться через pgAdmin/DBeaver:
   - Структура таблиц
   - Внешние ключи
   - Индексы

### 8.2. API

1. Открыть браузер: `http://localhost:3001/api/patients`
2. Показать JSON-ответ
3. С фильтром: `http://localhost:3001/api/patients?gender=male`

### 8.3. Клиент

1. Открыть DevTools (F12) → Network
2. Показать запросы при фильтрации

**Что демонстрируется:**
- Трёхуровневая архитектура (БД → API → UI)
- REST API с параметризованными запросами

---

## Граничные случаи

### Г1. Пациент с минимальными данными

**Шаги:**
1. Создать пациента только с обязательными полями
2. Все необязательные поля пустые

**Ожидаемый результат:**
- Пациент создан
- Пустые поля отображаются корректно (без ошибок)

### Г2. Очень длинное описание

**Шаги:**
1. Создать медицинскую запись с текстом 1000+ символов

**Ожидаемый результат:**
- Запись создана
- Текст обрезается/прокручивается в таблице

---

## Возможные вопросы и ответы

### Q: Почему PostgreSQL, а не MySQL?
**A:** PostgreSQL лучше поддерживает сложные запросы, имеет богатый набор типов данных и лучше работает с кириллицей.

### Q: Как обеспечивается безопасность?
**A:**
- Параметризованные SQL-запросы (защита от SQL-инъекций)
- Валидация на сервере
- В production: авторизация и HTTPS

### Q: Почему React?
**A:** React позволяет создавать интерактивный UI с автоматическим обновлением при изменении данных.

### Q: Какие индексы используются?
**A:**
- `idx_patients_insurance_policy` — поиск по полису
- `idx_patients_snils` — поиск по СНИЛС
- `idx_patients_full_name` — поиск по ФИО
- `idx_appointments_scheduled_at` — фильтрация по дате

---

## Тайминг демонстрации (15-20 минут)

| Время | Сценарий |
|-------|----------|
| 0-2 мин | Введение, запуск системы |
| 2-5 мин | Сценарий 1: Пациенты (создание, валидация, редактирование) |
| 5-7 мин | Сценарий 2: Запись на приём |
| 7-10 мин | Сценарий 3: Фильтры |
| 10-12 мин | Сценарий 4: Выборки |
| 12-14 мин | Сценарий 5: Экспорт CSV |
| 14-16 мин | Сценарий 6-7: Мед. записи, справочники (кратко) |
| 16-18 мин | Ответы на вопросы |

---

## Чек-лист перед защитой

- [ ] Docker запущен и БД работает
- [ ] Сервер запущен без ошибок
- [ ] Клиент открывается в браузере
- [ ] В базе есть тестовые данные
- [ ] Excel установлен для демонстрации CSV
- [ ] Подготовлены ответы на технические вопросы

---

## Тестовые данные в БД

### Пациенты:

| ID | Фамилия   | Имя       | Полис ОМС        | СНИЛС          |
|----|-----------|-----------|------------------|----------------|
| 1  | Иванов    | Александр | 1234567890123456 | 123-456-789 01 |
| 2  | Смирнова  | Екатерина | 1234567890123457 | 123-456-789 02 |
| 3  | Кузнецов  | Михаил    | 1234567890123458 | 123-456-789 03 |
| 4  | Васильева | Ольга     | 1234567890123459 | 123-456-789 04 |
| 5  | Соколов   | Дмитрий   | 1234567890123460 | 123-456-789 05 |

### Врачи:

| ID | Фамилия  | Имя    |
|----|----------|--------|
| 1  | Петров   | Иван   |
| 2  | Сидорова | Мария  |
| 3  | Козлов   | Алексей|
| 4  | Новикова | Елена  |
| 5  | Морозов  | Дмитрий|

### Специальности:

Терапевт, Кардиолог, Невролог, Эндокринолог, Отоларинголог, Хирург, Травматолог, Офтальмолог, Уролог, Педиатр, Гинеколог, Дерматолог, Психиатр, Стоматолог, Рентгенолог, УЗИ-специалист

### Диагнозы (МКБ-10):

| Код   | Название               |
|-------|------------------------|
| J00   | Острый назофарингит    |
| J06.9 | ОРВИ                   |
| J11   | Грипп                  |
| J18.9 | Пневмония неуточнённая |
| J20.9 | Острый бронхит         |
